<section class="user-id">
  <h1>VAULT DWELLLER ID</h1>
  @if (isMobileChanges | async) {
    <ng-container *ngTemplateOutlet="userImageTemplate"></ng-container>
  }
  <div class="user-info">
    @if (isEditModeSignal()) {
      <form [formGroup]="formGroup">
        <pro-input
          [formControl]="formGroup.controls.displayName"
          autocomplete="name"
          label="Name"
          placeholder="Vault Dweller Name"
          type="text"
        ></pro-input>
        @if (
          !formGroup.controls.displayName.hasError('required') &&
          formGroup.controls.displayName.hasError('pattern') &&
          formGroup.touched
        ) {
          <div class="custom-form-error">
            <p>Only A-Z, 1-9, ".", "_", or "-" allowed.</p>
          </div>
        }
        <pro-input
          [formControl]="formGroup.controls.roomNumber"
          autocomplete="off"
          label="Room Number"
          placeholder="Enter your Room Number"
          type="number"
        ></pro-input>
        <pro-input-datepicker
          [formControl]="formGroup.controls.dateOfBirth"
          [min]="dobMinDateTime"
          [max]="dobMaxDateTime"
          label="Date of Birth"
          autocomplete="bday"
          placeholder="Enter your Birthday"
        ></pro-input-datepicker>
        <pro-input
          [formControl]="formGroup.controls.skill"
          autocomplete="organization-title"
          label="Skill"
          placeholder="Enter your Occupation"
          type="text"
        ></pro-input>
        <pro-input
          [formControl]="formGroup.controls.vaultNumber"
          autocomplete="off"
          label="Vault Number"
          placeholder="Enter your Vault Number"
          type="number"
        ></pro-input>
      </form>
      <div class="user-actions">
        @if (isEditModeSignal()) {
          <pip-button
            (click)="cancelEdit()"
            [disabled]="isSavingSignal()"
            type="button"
          >
            CANCEL
          </pip-button>
          <pip-button
            (click)="updateProfile()"
            [disabled]="
              isSavingSignal() || formGroup.invalid || formGroup.pristine
            "
            type="button"
          >
            SAVE
          </pip-button>
        }
      </div>
    } @else {
      <div class="info-row">
        <strong>NAME: </strong>{{ user.displayName || '(unknown)' }}
      </div>
      <div class="info-row"><strong>UID: </strong>{{ user.uid }}</div>
      <div class="info-row"><strong>EMAIL: </strong>{{ user.email }}</div>
      <div class="info-row">
        <strong>ROOM#: </strong>{{ user.roomNumber || '(unknown)' }}
      </div>
      <div class="info-row">
        <strong>DOB: </strong
        >{{ (user.dateOfBirth | dateTime: 'MM.dd.yyyy') || '(unknown)' }}
      </div>
      <div class="info-row">
        <strong>SKILL: </strong>{{ user.skill || '(unknown)' }}
      </div>
      <!-- 
      <div class="info-row">
        <strong>VAULT: </strong> {{ user.vaultNumber || '(unknown)' }}
      </div>
      -->
      <pip-loading center>
        <div vaultNumber>
          {{ user.vaultNumber }}
        </div>
      </pip-loading>
    }
  </div>
</section>

@if ((isMobileChanges | async) === false) {
  <ng-container *ngTemplateOutlet="userImageTemplate"></ng-container>
}

<ng-template #userImageTemplate>
  <section class="user-image-container">
    <div class="pip-grid">
      <div class="pip-grid-item">
        <img
          [src]="localPhotoUrl || user.photoURL || 'images/user/user.png'"
          alt="User Image"
          class="user-image"
          referrerpolicy="no-referrer"
        />
      </div>
    </div>
    @if (isEditModeSignal()) {
      <pip-button type="button" (click)="openAvatarDialog()">
        CHANGE IMAGE
      </pip-button>
    }
  </section>
</ng-template>
