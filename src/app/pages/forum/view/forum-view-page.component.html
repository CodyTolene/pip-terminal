@if (post(); as post) {
  <pip-forum-header
    [category]="post.category"
    [post]="post"
    [user]="userChanges | async"
  />

  <section class="post">
    <pip-panel>
      <pip-forum-post [post]="post" simple />
    </pip-panel>
  </section>

  <section class="actions">
    @if (userChanges | async; as user) {
      @if (isReplying()) {
        <form [formGroup]="formGroup" (ngSubmit)="submitComment()">
          <pro-input-textarea
            [formControl]="formGroup.controls.content"
            appearance="outline"
            label="Comment"
            placeholder="Add a comment..."
          ></pro-input-textarea>
          <div class="action-buttons">
            <pip-button [disabled]="isSubmitting()" (click)="cancelComment()">
              Cancel
            </pip-button>
            <pip-button
              type="submit"
              [disabled]="formGroup.invalid || isSubmitting()"
            >
              Submit
            </pip-button>
          </div>
        </form>
      } @else {
        <div class="action-buttons">
          <ng-container *ngTemplateOutlet="commentPagination" />
          <pip-button (click)="isReplying.set(true); formGroup.reset()"
            >Reply</pip-button
          >
        </div>
      }
    } @else {
      <div class="action-buttons">
        <ng-container *ngTemplateOutlet="commentPagination" />
        <pip-button
          [routerLink]="loginLink"
          [queryParams]="getReturnUrlQueryParams()"
          >Reply</pip-button
        >
      </div>
    }
  </section>

  <section class="comments">
    @if (comments().length > 0) {
      <pip-panel>
        @for (comment of comments(); track comment.id) {
          <pip-forum-comment [comment]="comment" />
        }
      </pip-panel>
    } @else {
      <p class="no-comments"><i>No comments yet.</i></p>
    }
  </section>
} @else if (loading()) {
  <p>[LOADING] Please stand by...</p>
} @else if (error()) {
  <p>[ERROR] Unable to load post. Please try again later.</p>
}

<ng-template #commentPagination>
  <pip-button
    [disabled]="loadingComments() || !hasPrevCommentsPage()"
    (click)="prevPageComments()"
  >
    Prev
  </pip-button>
  <pip-button
    [disabled]="loadingComments() || !hasNextCommentsPage()"
    (click)="nextPageComments()"
  >
    Next
  </pip-button>
</ng-template>

<pip-footer />
