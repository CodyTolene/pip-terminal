<pip-forum-header [user]="userChanges | async" />

<section class="intro">
  <pip-title h1>Community Forum</pip-title>
  <p>
    <strong>[ Vault-Tec Community Bulletin ]</strong>
    Welcome to the Pip-Boy Community Forum. This console lists all the available
    categories and the newest posts recovered from the network. Entries are
    compiled by certified vault dwellers and made ready for civilian review.
    Pick a category to dive in, or scroll to the most Recent Posts below.
  </p>
</section>

<section>
  <pip-panel>
    <h3>Categories</h3>
    <div class="pip-grid">
      @for (cat of categories; track cat.key) {
        <a [routerLink]="cat.link" class="pip-grid-item">
          <h4>{{ cat.name }}</h4>
          <span>{{ cat.description }}</span>
        </a>
      }
    </div>
  </pip-panel>
</section>

<section>
  <div class="forum-posts">
    <h3>Recent Posts</h3>
    @if (loading()) {
      <pip-loading center />
      <p class="loading"><i>PLEASE STAND BY</i></p>
    } @else if (posts().length === 0) {
      <ng-container *ngTemplateOutlet="noPostsTemplate" />
    } @else {
      @for (post of posts(); track post.id; let i = $index) {
        <pip-forum-post linkedPost [post]="post" />
      }
      @if (showAds()) {
        <pip-adsense-unit
          [fullWidthResponsive]="true"
          adClient="ca-pub-4966893083726404"
          adSlot="4516696288"
        />
      }

      <div class="pagination">
        <pip-button
          (click)="prevPagePosts()"
          [disabled]="loading() || !hasPrevPage()"
          [matTooltip]="'Previous Page'"
        >
          <mat-icon fontSet="material-icons-outlined">chevron_left</mat-icon>
        </pip-button>
        <pip-button
          (click)="nextPagePosts()"
          [disabled]="loading() || !hasNextPage()"
          [matTooltip]="'Next Page'"
        >
          <mat-icon fontSet="material-icons-outlined">chevron_right</mat-icon>
        </pip-button>
      </div>
    }
  </div>
</section>

<ng-template #noPostsTemplate>
  @if (userChanges | async) {
    <p>No posts yet. Be the first to share something!</p>
  } @else {
    <p>
      No posts yet. Please
      <a [routerLink]="loginLink" class="action-link">log in</a>or
      <a [routerLink]="registerLink" class="action-link">register</a>to share
      something!
    </p>
  }
</ng-template>

<pip-footer />
