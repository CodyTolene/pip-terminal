<pip-forum-header [user]="userChanges | async" />

<section class="intro">
  <pip-title h1>Community Forum</pip-title>
  <p>
    <strong>[ Vault-Tec Community Bulletin ]</strong>
    Welcome to the Pip-Boy Community Forum. This console lists
    {{ categories.length }} categories and the newest
    {{ postsMaxPerPage }} posts recovered from the network. Entries are compiled
    by certified vault dwellers and made ready for civilian review. Expect
    repair notes, build logs, radio findings, tuning tips, and field reports
    from the wastes. Pick a category card to dive in, or scroll to Recent Posts
    below. Be civil, mark spoilers, credit sources, and report hazards through
    the menu.
  </p>
</section>

<section>
  <pip-panel>
    <h3>Categories</h3>
    <div class="pip-grid">
      @for (cat of categories; track cat.key) {
        <a [routerLink]="cat.link" class="pip-grid-item">
          <h4>{{ cat.name }}</h4>
          <span>{{ cat.description }}</span>
        </a>
      }
    </div>
  </pip-panel>
</section>

<section>
  <div class="forum-posts">
    <h3>Recent Posts</h3>
    @if (loading()) {
      <p class="loading">Loading...</p>
    } @else if (posts().length === 0) {
      <ng-container *ngTemplateOutlet="noPostsTemplate" />
    } @else {
      @for (post of posts(); track post.id) {
        <div class="post-group">
          <a [routerLink]="post.url" class="forum-post">
            <div class="post-header">
              <h5>{{ post.title }}</h5>
              <span class="timestamp">
                {{ post.createdAt | dateTime: 'MM/dd/yyyy, hh:mm a (ZZZZ)' }}
              </span>
            </div>
            <div class="post-body">
              <p class="category">Category: {{ post.category }}</p>
              <p>{{ post.content }}</p>
              <p class="signature">â€” {{ post.authorName }}</p>
            </div>
          </a>
        </div>
      }

      <div class="pagination">
        <pip-button
          [disabled]="loading() || !hasPrevPage()"
          (click)="prevPagePosts()"
          [matTooltip]="'Previous Page'"
        >
          <mat-icon fontSet="material-icons-outlined">chevron_left</mat-icon>
        </pip-button>
        <pip-button
          [disabled]="loading() || !hasNextPage()"
          (click)="nextPagePosts()"
          [matTooltip]="'Next Page'"
        >
          <mat-icon fontSet="material-icons-outlined">chevron_right</mat-icon>
        </pip-button>
      </div>
    }
  </div>
</section>

<ng-template #noPostsTemplate>
  @if (userChanges | async) {
    <p>No posts yet. Be the first to share something!</p>
  } @else {
    <p>
      No posts yet. Please
      <a [routerLink]="loginLink" class="action-link">log in</a>or
      <a [routerLink]="registerLink" class="action-link">register</a>to share
      something!
    </p>
  }
</ng-template>

<pip-footer />
